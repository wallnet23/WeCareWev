<div class="arrowBtn d-none d-md-inline">
    <a (click)="goBack()" class="btn btn-outline-dark">
        <i class="bi bi-arrow-left arrowIcon"></i>
    </a>
</div>

<div class="container-fluid p-1 p-md-2 p-lg-3 p-xl-4" style="background-color: white; min-height: 90vh;">
    <div class="row justify-content-center">
        <div class="col-12 text-center mt-2" style="max-width: 1200px;">
            <span class="panelTitle">
                {{"TICKET.NEW.NEWTICKETSMALL" | translate}}
            </span>

            <div [formGroup]="newTicketForm" class="row justify-content-center mt-2 p-1 p-md-2 p-lg-3">
                <!-- SYSTEM POPUP -->
                <div class="col-12 mb-1 text-start">
                    <span class="form-label">
                        {{"TICKET.NEW.SYSTEMINFO" | translate}}
                    </span>
                    <button class="btn btn-sm btn-outline-dark ms-2" (click)="systemInfoPopup()">
                        <i class="bi bi-card-text"></i>
                    </button>
                </div>

                <!-- EMAIL -->
                <div class="col-12 col-md-6 text-start">
                    <label class="form-label" for="email">
                        {{"TICKET.NEW.EMAIL" | translate}}
                    </label>
                    <input class="form-control" type="text" id="email" formControlName="email">
                </div>

                <!-- REQUEST -->
                <div class="col-12 col-md-6 text-start">
                    <label class="form-label" for="request">
                        {{"TICKET.NEW.REQUEST" | translate}}
                    </label>
                    <select class="form-select" id="request" formControlName="request">
                        <option [ngValue]="null">
                            --
                        </option>
                        <option *ngFor="let request of requestList" [ngValue]="request.id">
                            {{request.title}}
                        </option>
                    </select>
                </div>

                <ng-container>
                    <div class="col-12 mt-3">
                        <span style="font-weight: bold; font-size: large;">
                            {{"TICKET.NEW.ANOMALYFOUNDED" | translate}}
                        </span>
                    </div>

                    <!-- INVERTER LIST -->
                    <div class="col-12 mt-2 mb-2 ps-md-3 ps-lg-5 pe-md-3 pe-lg-5 text-start"
                        formArrayName="inverterList">
                        <span class="listTitle">
                            {{"TICKET.NEW.INVERTERLIST" | translate}}
                        </span>
                        <div class="row align-items-group mt-2" style="border-bottom: 1px solid lightgray;">
                            <div class="col-12 col-sm-6 col-md-4 col-xl-3 text-start"
                                *ngFor="let inverter of inverterList.controls; let i = index" [formGroupName]="i">
                                <div class="form-check">
                                    <label class="form-check-label ms-2" for="selected_inverter-{{i}}">
                                        {{inverter.get('sn')?.value}}
                                    </label>
                                    <input class="form-check-input" type="checkbox" id="selected_inverter-{{i}}">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- BATTERY LIST -->
                    <div class="col-12 mt-2 mb-2 ps-md-3 ps-lg-5 pe-md-3 pe-lg-5 text-start"
                        formArrayName="batteryList">
                        <span class="listTitle">
                            {{"TICKET.NEW.BATTERYLIST" | translate}}
                        </span>
                        <div class="row align-items-group mt-2" style="border-bottom: 1px solid lightgray;">

                            <div class="col-12 col-sm-6 col-md-4 col-xl-3 text-start"
                                *ngFor="let battery of batteryList.controls; let i = index" [formGroupName]="i">
                                <div class="form-check">
                                    <label class="form-check-label ms-2" for="selected_battery-{{i}}">
                                        {{battery.get('sn')?.value}}
                                    </label>
                                    <input class="form-check-input" type="checkbox" id="selected_battery-{{i}}">
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>

                <div class="col-12 mt-2 text-start">
                    <label class="form-label" for="description">
                        {{"TICKET.NEW.PROBLEMDESCRIPTION" | translate}}
                    </label>
                    <textarea class="form-control" type="text" id="description" formControlName="description" rows="3">
                        </textarea>
                </div>

                <div class="col-12 mt-2">
                    <label *ngIf="fileList.length < maxImages" for="fileUpload2" class="btn btn-outline-dark mt-1">
                        <i class="bi bi-paperclip"></i>
                        <input type="file" id="fileUpload2" style="display: none;" (change)="onFileSelected($event)"
                            multiple>
                    </label>

                    <div class="row justify-content-center mt-2">
                        <div *ngFor="let img of imagesList" class="col-auto">
                            <img style="height: 50px; width: 40px; border: 1px solid lightgray; object-fit: cover;"
                                [src]="'assets/img/'+img.src" [title]="img.src">
                        </div>
                    </div>
                </div>
            </div>

            <div class="row justify-content-end pt-1 ps-1 pe-1 pt-md-2 ps-md-2 pe-md-2 pt-lg-3 ps-lg-3 pe-lg-3"
                style="border-top: 1px solid lightgray;">
                <div class="col-auto">
                    <button class="btn btn-outline-success" (click)="createTicket()">
                        {{"TICKET.NEW.CREATE" | translate}}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>